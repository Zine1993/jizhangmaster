<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>正在跳转到 App…</title>
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif; padding: 24px; line-height: 1.6; color: #111; }
      .hint { display:none; margin-top: 16px; }
      code { background: #f4f4f5; padding: 2px 6px; border-radius: 4px; }
      a.btn { display:inline-block; margin-top:12px; padding:10px 14px; background:#4f46e5; color:#fff; text-decoration:none; border-radius:8px; }
    </style>
    <script>
      (function() {
        try {
          // 取回 Supabase 邮件回调中的参数（可能在 hash 或 query）
          var hash = window.location.hash || '';
          var query = window.location.search || '';
          var suffix = hash ? hash : (query ? ('#' + query.slice(1)) : '');

          // 你的 App 自定义 scheme（与 app.json 的 "scheme" 保持一致）
          var deep = 'moodledger://auth/reset' + suffix;

          // 直接尝试打开 App
          window.location.replace(deep);

          // 若未成功（浏览器限制等），展示备用链接
          setTimeout(function() {
            var a = document.getElementById('openLink');
            a.href = deep;
            document.getElementById('hint').style.display = 'block';
            document.getElementById('url').textContent = deep;
          }, 1200);
        } catch (e) {}
      })();
    </script>
  </head>
  <body>
    <h1>正在打开应用…</h1>
    <p>如果几秒内未自动跳转，请点击下面的按钮或复制链接手动打开：</p>
    <p class="hint" id="hint">
      深链：<code id="url"></code><br />
      <a id="openLink" class="btn" href="#">打开 App</a>
    </p>
    <p>若仍无法打开，请将链接复制到系统浏览器地址栏，或确认已安装最新版本 App。</p>
  </body>
</html>